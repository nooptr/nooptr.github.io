{"componentChunkName":"component---src-templates-post-template-js","path":"/2019/06/15/thiet-ke-api-rate-limiting/","result":{"data":{"markdownRemark":{"id":"46214055-836c-5fed-ab2a-4be25af29370","html":"<p>Làm việc nhiều với API chắc hẳn ai cũng đã từng nghe thấy từ <strong>API Rate Limiting</strong>. Ví dụ như với Github API thì Rate Limiting của nó như sau:</p>\n<ul>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 644px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/910efdd61dc347d97e1e84aadfe54353/5b815/Screen-Shot-2019-06-15-at-12.51.33.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.3416149068323%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAZElEQVQI142MSw6AIAxEuRsQpiVCQsEPJur9TyG4cuPnTTOZzasKEqLEUksaU26UXnLBzFpr84yiBVzJ70wZiK4dJWBw1vS8o2iGP5g3al+QnMWXcZchjtduUgVNaMPCGP1LPgHXFkOO40C5tgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/910efdd61dc347d97e1e84aadfe54353/01472/Screen-Shot-2019-06-15-at-12.51.33.webp 240w,\n/static/910efdd61dc347d97e1e84aadfe54353/222bd/Screen-Shot-2019-06-15-at-12.51.33.webp 480w,\n/static/910efdd61dc347d97e1e84aadfe54353/ad6ba/Screen-Shot-2019-06-15-at-12.51.33.webp 644w\"\n          sizes=\"(max-width: 644px) 100vw, 644px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/910efdd61dc347d97e1e84aadfe54353/0783d/Screen-Shot-2019-06-15-at-12.51.33.png 240w,\n/static/910efdd61dc347d97e1e84aadfe54353/782f4/Screen-Shot-2019-06-15-at-12.51.33.png 480w,\n/static/910efdd61dc347d97e1e84aadfe54353/5b815/Screen-Shot-2019-06-15-at-12.51.33.png 644w\"\n          sizes=\"(max-width: 644px) 100vw, 644px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/910efdd61dc347d97e1e84aadfe54353/5b815/Screen-Shot-2019-06-15-at-12.51.33.png\"\n          alt=\"Screen Shot 2019 06 15 at 12 51 33\"\n          title=\"Screen Shot 2019 06 15 at 12 51 33\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></li>\n</ul>\n<p>Nhìn vào hình trên có thể thấy Rate Limiting của nó 60 request/min. Nếu mà trong vòng 1 phút gửi quá 60 request thì sẽ không gửi tiếp được nữa. Mà phải đợi đến phút tiếp theo mới gửi được.</p>\n<p>Hiện tại hầu hết các hệ thống lớn trên thế giới đều cung cấp Rate Liming cả. Nhưng mà ít ai để ý đến công nghệ đằng sau nó như thế nào.</p>\n<p>Hôm nay mình viết bài này để hướng dẫn mọi người cách thiết kế <strong>Rate Limiting</strong> như thế nào.</p>\n<h2 id=\"rate-limiting-là-gì\"><a href=\"#rate-limiting-l%C3%A0-g%C3%AC\" aria-label=\"rate limiting là gì permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rate Limiting là gì?</h2>\n<p>Giả sử như hệ thống của chúng ta nhận được hàng nghìn request nhưng mà trong số đó chỉ xử lí được trăm request/s chẳng hạn, và số request còn lại thì bị lỗi (do CPU hệ thống đang quá tải không thể xử lí được).</p>\n<p>Để giải quyết được vấn đề này thì cơ chế Rate Limiting đã ra đời. Mục đích của nó chỉ cho phép nhận 1 số lượng request nhất định trong 1 đơn vị thời gian. Nếu quá sẽ trả về response lỗi.</p>\n<p>1 số ví dụ hay gặp trong Rate Limiting như:</p>\n<ul>\n<li>Mỗi người dùng chúng ta chỉ cho phép gửi 100request/s. Nếu vượt quá thì sẽ trả về response lỗi.</li>\n<li>Mỗi người dùng chỉ cho phép nhập sai thẻ credit 3 lần trong 1 ngày</li>\n<li>Mỗi địa chỉ IP chỉ có thể tạo được 2 account trong 1 ngày.</li>\n</ul>\n<p><strong>Về cơ bản thì rate limiter sẽ cho phép gửi bao nhiêu request trong 1 khoảng thời gian nào đó. Nếu vượt quá sẽ bị block lại.</strong></p>\n<h2 id=\"tại-sao-api-cần-phải-có-rate-limiting\"><a href=\"#t%E1%BA%A1i-sao-api-c%E1%BA%A7n-ph%E1%BA%A3i-c%C3%B3-rate-limiting\" aria-label=\"tại sao api cần phải có rate limiting permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tại sao API cần phải có Rate Limiting?</h2>\n<p>Rate Limiting sẽ giúp chúng ta hạn chế được 1 số việc sau:</p>\n<ul>\n<li>Tấn công DOS (Denial of Service) đến hệ thống</li>\n<li>Brute force password trong hệ thống (quyét kiểu vét cạn)</li>\n<li>Brute force thông tin thẻ credit card (quyét kiểu vét cạn)</li>\n</ul>\n<p>Những cuộc tấn công này nhìn có vẻ như đến từ người dùng thực, nhưng thực tế nó được tạo ra bởi bot. Do vậy mà nó rất khó bị phát hiện và dễ dàng làm service của chúng ta bị sập.</p>\n<p>Ngoài ra, Rate Limiting cũng mang lại cho chúng ta 1 số lợi ích sau:</p>\n<ul>\n<li><strong>Bảo mật</strong>: Không cho phép nhập sai password quá nhiều lần</li>\n<li><strong>Doanh thu</strong>: Với mỗi plan sẽ có rate limit khác nhau. Nếu muốn dùng nhiều hơn thì cần mua lên plan đắt tiền hơn. </li>\n</ul>\n<h2 id=\"yêu-cầu-hệ-thống\"><a href=\"#y%C3%AAu-c%E1%BA%A7u-h%E1%BB%87-th%E1%BB%91ng\" aria-label=\"yêu cầu hệ thống permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Yêu cầu hệ thống</h2>\n<p><strong>Yêu cầu chức năng:</strong></p>\n<ul>\n<li>Giới hạn số lượng request được gửi trong 1 đơn vị thời gian. Ví dụ 15 request/s</li>\n</ul>\n<p><strong>Yêu cầu phi chức năng:</strong></p>\n<ul>\n<li>Hệ thống chịu tải cao. Bởi vì rate limiter luôn luôn phải hoạt động để bảo vệ hệ thống từ các cuộc tấn công bên ngoài vào.</li>\n<li>Rate limiting cần có latency thấp nhất để giúp trải nghiệm người dùng tốt hơn.</li>\n</ul>\n<h2 id=\"rate-limiting-hoạt-động-như-thế-nào\"><a href=\"#rate-limiting-ho%E1%BA%A1t-%C4%91%E1%BB%99ng-nh%C6%B0-th%E1%BA%BF-n%C3%A0o\" aria-label=\"rate limiting hoạt động như thế nào permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rate Limiting hoạt động như thế nào?</h2>\n<p>Rate Limiting có 1 process tên là <strong>Throttling</strong> dùng để kiểm soát tình trạng sử dụng API của người dùng trong 1 khoảng thời gian nhất định.</p>\n<p>Khi vượt quá giới hạn, nó sẽ trả về response với HTTP Status là 429 - Too many requests.</p>\n<h2 id=\"thuật-toán-sử-dụng-trong-rate-limiting\"><a href=\"#thu%E1%BA%ADt-to%C3%A1n-s%E1%BB%AD-d%E1%BB%A5ng-trong-rate-limiting\" aria-label=\"thuật toán sử dụng trong rate limiting permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thuật toán sử dụng trong Rate Limiting</h2>\n<p>Có 2 loại thuật toán hay được dùng để giải quyết bài toán này:</p>\n<p><strong>Thuật toán Token Bucket</strong></p>\n<p>Thuật toán này sẽ được tính từ đầu đơn vị thời gian cho đến hết đơn vị thời gian.</p>\n<ul>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db3e897006dbb4b136e047e99f81a32e/5e61e/api-rate-limiting-algorithm-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.30863121185702%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAuElEQVQI1w2MS64DIQwE5/7ny+Ip2eSFzA8mJhgwfztIvSi1SrUIs/Q+aj23bXsra7Te9wnc2/ylNe7dXtf6epnjAGMmZIoyuoyxSB+c8lxGTM5Vhw2xOCc5MxHHKKXUECpic5jRR2s70TxndyH7rhGkBq5BWjCg7qf6OxQGaBGa17ftn6Ldrb5vD+kkjZyH2/okUIt3ED2KDB5NeEb95wvHZUpOJYUU8PxMJgxowExtOqWk9dy/oH+tbuPD3yZgHwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/db3e897006dbb4b136e047e99f81a32e/01472/api-rate-limiting-algorithm-1.webp 240w,\n/static/db3e897006dbb4b136e047e99f81a32e/222bd/api-rate-limiting-algorithm-1.webp 480w,\n/static/db3e897006dbb4b136e047e99f81a32e/620b9/api-rate-limiting-algorithm-1.webp 960w,\n/static/db3e897006dbb4b136e047e99f81a32e/1b6cd/api-rate-limiting-algorithm-1.webp 1147w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/db3e897006dbb4b136e047e99f81a32e/0783d/api-rate-limiting-algorithm-1.png 240w,\n/static/db3e897006dbb4b136e047e99f81a32e/782f4/api-rate-limiting-algorithm-1.png 480w,\n/static/db3e897006dbb4b136e047e99f81a32e/f570d/api-rate-limiting-algorithm-1.png 960w,\n/static/db3e897006dbb4b136e047e99f81a32e/5e61e/api-rate-limiting-algorithm-1.png 1147w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/db3e897006dbb4b136e047e99f81a32e/f570d/api-rate-limiting-algorithm-1.png\"\n          alt=\"api rate limiting algorithm 1\"\n          title=\"api rate limiting algorithm 1\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></li>\n</ul>\n<p>Ví dụ như trong ví dụ bên trên ta có thể thấy, trong khoảng thời gian từ giây thứ 0 cho đến giây thứ 1 có 2 request được gửi, đó là m1 và m2.</p>\n<p>Trong khoảng thời gian từ giây thứ 1 đến giây thứ 2 có 3 request là m3, m4, m5.</p>\n<p>Nếu như rate limiting đang được cài đặt là 2 thì trong ví dụ bên trên thì thằng m5 sẽ bị block lại. </p>\n<p><strong>Thuật toán Sliding Window (Rolling Window</strong>)</p>\n<p>Trong thuật toán này thì thời gian sẽ được tính từ phần tử thời gian mà yêu cầu được thực hiện cộng với độ dài của time window.</p>\n<ul>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/85f34890ce9e47a4e2096f54091cd585/1351f/api-rate-limiting-algorithm-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.68313458262351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7UlEQVQY012PwU7EMAxE+/9fBzcEEgtts2naRm7STZ3EsU32Bozm9PSksQdl7q2Ii7X3eYJ9W4xx9q6taSMh4kZ+W8007c75dZ3HsSAKN2EelJrkzIg5RjwOOs8SY42xQ7lQ0qW1lvPRIcXYnXRAlzVnJRoSzJRAS9Lae87b14czb3bEFFoCDO5lurUcv/fltnxqfWhDiP51fC/BDgF8waTSlKn3fAQ4j+3wjamW60phPXx/K3Qe/FOTljPenY3gB/0dUUGVfmmgC0oGqoEzlBq5Q0X9l0FE/gBWbQo7WGOd7avBjCZAfHL+OyTyA1ksWUpFfcaVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/85f34890ce9e47a4e2096f54091cd585/01472/api-rate-limiting-algorithm-2.webp 240w,\n/static/85f34890ce9e47a4e2096f54091cd585/222bd/api-rate-limiting-algorithm-2.webp 480w,\n/static/85f34890ce9e47a4e2096f54091cd585/620b9/api-rate-limiting-algorithm-2.webp 960w,\n/static/85f34890ce9e47a4e2096f54091cd585/1b380/api-rate-limiting-algorithm-2.webp 1174w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/85f34890ce9e47a4e2096f54091cd585/0783d/api-rate-limiting-algorithm-2.png 240w,\n/static/85f34890ce9e47a4e2096f54091cd585/782f4/api-rate-limiting-algorithm-2.png 480w,\n/static/85f34890ce9e47a4e2096f54091cd585/f570d/api-rate-limiting-algorithm-2.png 960w,\n/static/85f34890ce9e47a4e2096f54091cd585/1351f/api-rate-limiting-algorithm-2.png 1174w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/85f34890ce9e47a4e2096f54091cd585/f570d/api-rate-limiting-algorithm-2.png\"\n          alt=\"api rate limiting algorithm 2\"\n          title=\"api rate limiting algorithm 2\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></li>\n</ul>\n<p>Như trong ví dụ bên trên, giả sử như m1 và m2 được gửi từ giây thứ 0.3s. Khi đó từ 0.3s này sẽ bắt đầu tính. </p>\n<p>Trong khoảng 0.3s tiếp theo chúng ta thấy có 2 request tiếp theo được gửi đến đó là m3 và m4. </p>\n<p>Như vậy trong khoảng thời gian 0.6s này đã có 4 request được gửi là m1,m2,m3,m4.</p>\n<p>Nếu Rate Limiting đang cài đặt là 2 thì khi đó m3,m4 sẽ bị block lại. </p>\n<p>Giả sử như thời điểm gửi m5 là lúc 1.1s chẳng hạn. Thì khi đó lúc này rate limiting sẽ reset lại thành từ 0. Và lại lặp lại quá trình đó, và m5 sẽ được tính thành 1 lần.</p>\n<h2 id=\"kiến-trúc-rate-limiting\"><a href=\"#ki%E1%BA%BFn-tr%C3%BAc-rate-limiting\" aria-label=\"kiến trúc rate limiting permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kiến trúc Rate Limiting</h2>\n<ul>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 644px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef9e05c3c6a9c240486dc8117cb30d44/5b815/0d66e652d50897f7c4c57200408f4ca3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.39751552795032%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+klEQVQ4y51Ty27TQBTtV7KgWwoV3wAfARukQFVYEAkQC1agSpVa1BSSlFCFyC1pnPqZ8TOx44T4NT6Mxw5xFkhprnQ81+M7x2fOndnBhpFlGUceSZoiDGPEcYIoSnhOafFt5y6EeaRsoa70YUpnEIVjqDcnMOXvsEyyHWGSUphkiKlxAUs+h62cwzcv4dgm8pLtCEcDeKTF1J0ypY2S0NqcsOpfmmZcoccU2moTrtaElxM6JeGysLpoOVbzlULmoSzAJw3I10cg4jHbfhu2ZawU5sW0JFz/AUVGc6T5BJ+zbRfDmx5M9Qe0YRMjqQUid5hCu2hKVU2pqSRbn6UM7niCcLEoqui/8gKlCK5wHmf40A3RVJKqcZiOfmOqC5goPYg/T7EIxqWPKYjjwnBzjGGwPIrj1bF5143x+L2Bp18CCHqAeeCDqBLU+h5uD++jf7CL0et7kFuf8CeiaHe7ePTiDR48e4m956+wz/IrWV0RhkkGZ57BmmWIEsoVRFEIX76Ef3sBX+qwsY3ZxOC7G3seznrXOGp18PlbG19/XcELZv/zcLPzyLceReyR5Mm6h1mlw2soO7wEpUUnHMfB23odmqbxZh2c6Gj0/btdPd7pkpAQglqtBkWW+PvDQxFPPirb3eWc1LIsDAYDGIbBvI4gDHX0RMK8T/AXTSR8d2hLgFUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/ef9e05c3c6a9c240486dc8117cb30d44/01472/0d66e652d50897f7c4c57200408f4ca3.webp 240w,\n/static/ef9e05c3c6a9c240486dc8117cb30d44/222bd/0d66e652d50897f7c4c57200408f4ca3.webp 480w,\n/static/ef9e05c3c6a9c240486dc8117cb30d44/ad6ba/0d66e652d50897f7c4c57200408f4ca3.webp 644w\"\n          sizes=\"(max-width: 644px) 100vw, 644px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/ef9e05c3c6a9c240486dc8117cb30d44/0783d/0d66e652d50897f7c4c57200408f4ca3.png 240w,\n/static/ef9e05c3c6a9c240486dc8117cb30d44/782f4/0d66e652d50897f7c4c57200408f4ca3.png 480w,\n/static/ef9e05c3c6a9c240486dc8117cb30d44/5b815/0d66e652d50897f7c4c57200408f4ca3.png 644w\"\n          sizes=\"(max-width: 644px) 100vw, 644px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/ef9e05c3c6a9c240486dc8117cb30d44/5b815/0d66e652d50897f7c4c57200408f4ca3.png\"\n          alt=\"0d66e652d50897f7c4c57200408f4ca3\"\n          title=\"0d66e652d50897f7c4c57200408f4ca3\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></li>\n</ul>\n<p>Rate Limiting sẽ đảm nhiệm việc quyết định xem request nào sẽ được gửi đến API Server, request nào sẽ bị block.</p>\n<p>Mỗi khi Client gửi request đến Web Server, Web Server sẽ gọi đến Rate Limiter để check xem ngươi dùng này đã vượt quá số Rate Limiting hay chưa? Nếu chưa thì sẽ gửi request đó đến API Server. Nếu đã vượt quá rồi thì sẽ block lại và trả về http status 429 (Too many requests).</p>\n<h2 id=\"cài-đặt-thuật-toán\"><a href=\"#c%C3%A0i-%C4%91%E1%BA%B7t-thu%E1%BA%ADt-to%C3%A1n\" aria-label=\"cài đặt thuật toán permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cài đặt thuật toán</h2>\n<h3 id=\"1-thuật-toán-token-bucket\"><a href=\"#1-thu%E1%BA%ADt-to%C3%A1n-token-bucket\" aria-label=\"1 thuật toán token bucket permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Thuật toán Token Bucket</h3>\n<p>Khi người dùng gửi request đến hệ thống, chúng ta sẽ lưu số request đã gửi vào 1 biến <strong>count</strong> cùng với thời điểm <strong>start_time</strong> gửi request. </p>\n<p>Sau đó sẽ lưu count vs timestamp vào 1 hash table (Có thể là Redis, memcached …). Trong đó key sẽ là user_id và value sẽ chứa json bao gồm số lượng request đã gửi, cùng với thời điểm timestamp.</p>\n<p><strong>Tại sao nên dùng Redis mà không nên dùng mysql?</strong></p>\n<p>Dùng mysql để lưu trữ dữ liệu là 1 ý tưởng khá tồi. Bởi vì thời gian đọc ghi dữ liệu ở mysql sẽ lâu hơn rất nhiều so với việc dùng redis (memory).</p>\n<p>Ví dụ như chúng ta mất 1ms để lưu 1 record vào mysql thì khi đó 1s chúng ta sẽ xử lí được 1000 request.</p>\n<p>Thế nhưng với hệ thống như Redis nó không sử dụng disk mà sử dụng memory để lưu nên tốc độ đọc ghi sẽ khá là nhanh. Ví dụ nó mất 100 nanosec để lưu 1 record thì 1s nó sẽ xử lí được tầm 10 triệu request.</p>\n<p>Mà hệ thống Rate Limiting này cần phải tối đa tốc độ query để lấy count nên Redis sẽ hợp lí hơn rất nhiều.</p>\n<p>Về cấu trúc dữ liệu lưu trong hash table sẽ như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;code&gt;user_id: {count, start_time}\n\nVí dụ:\n12: {3, 1560580210}\n5: {2, 1560520442}&lt;/code&gt;</code></pre></div>\n<p>Giả sử như rate limiter sẽ cho phép <strong>3 request/min</strong>. Khi đó flow thực hiện sẽ như sau:</p>\n<ol>\n<li>Nếu user<em>id không có trong hash table, khi đó sẽ insert user</em>id vào trong hash table cùng với thời điểm gửi (dạng epoch time)</li>\n<li>\n<p>Nếu user<em>id có nằm trong hash table, khi đó sẽ tìm value tương ứng với user</em>id đó và tính toán xem current<em>time - start</em>time >= 1 min hay không?</p>\n<ol>\n<li>Nếu có lớn hơn thì khi đó set start<em>time bằng current</em>time và count = 1 và cho phép request gửi đến API Server.</li>\n<li>Nếu nhỏ hơn thì kiểm tra xem count có lớn hơn 3 hay không. Nếu lớn hơn thì sẽ block request đó lại. Nếu nhỏ hơn thì sẽ count = count + 1 và cho phép request gửi đến API Server.</li>\n</ol>\n</li>\n<li><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5c45cb97be6325da48ef07988fa5df5f/5df5c/fixed-window-example.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125.34482758620689%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAwAEAgX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAH3BUc7W5mIGnDL0RSr/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAECEBESMf/aAAgBAQABBQI6Ym60jWiY/CJ//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIBEBH/2gAIAQMBAT8BWkgw/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIBEBH/2gAIAQIBAT8Bank0/8QAHBAAAgICAwAAAAAAAAAAAAAAAAIDMTLRARCB/9oACAEBAAY/AjNDJTZcZaeGy4y0Oe//xAAfEAACAgIBBQAAAAAAAAAAAAAAASExEUFxEGGhsfH/2gAIAQEAAT8hrLru6HmQPKW8GnqOA5ImgGn8DoUXoPG6UP/aAAwDAQACAAMAAAAQaNGy/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EAJIbaDJ2//EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8QSMPLBIeX/8QAHhAAAQQDAQEBAAAAAAAAAAAAAQAhMXERUWGxQaH/2gAIAQEAAT8QgAEwDpLtHurRWXWY+qC4LjwWrj1y1lN9/hvUQQVwxky09s65aFnk719X6iKltf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/5c45cb97be6325da48ef07988fa5df5f/01472/fixed-window-example.webp 240w,\n/static/5c45cb97be6325da48ef07988fa5df5f/222bd/fixed-window-example.webp 480w,\n/static/5c45cb97be6325da48ef07988fa5df5f/620b9/fixed-window-example.webp 960w,\n/static/5c45cb97be6325da48ef07988fa5df5f/e72b4/fixed-window-example.webp 1160w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/5c45cb97be6325da48ef07988fa5df5f/3bc27/fixed-window-example.jpg 240w,\n/static/5c45cb97be6325da48ef07988fa5df5f/98431/fixed-window-example.jpg 480w,\n/static/5c45cb97be6325da48ef07988fa5df5f/b3ee8/fixed-window-example.jpg 960w,\n/static/5c45cb97be6325da48ef07988fa5df5f/5df5c/fixed-window-example.jpg 1160w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/5c45cb97be6325da48ef07988fa5df5f/b3ee8/fixed-window-example.jpg\"\n          alt=\"fixed window example\"\n          title=\"fixed window example\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></li>\n</ol>\n<p><strong>Vấn đề với thuật toán này là gì?</strong></p>\n<p>Trong hệ thống phân tán thì hành vi “read and then write - đọc sau đó ghi” sẽ tạo ra 1 race condition (khi nhiều thread cùng truy cập và cùng 1 lúc muốn thay đổi dữ liệu), và làm cho dữ liệu tính toán sẽ không đúng nữa. </p>\n<p>Ví dụ như tại giây 45.01 count hiện tại đang là 2. Khi đó người dùng đó call api. Vì count vẫn đang nhỏ hơn 3 (giả sử như rate limiting đang là 3 request/min). Trong khi đang chuẩn bị update count này thành 3 thì ngay lúc đó có 1 request nữa được gửi đến. Và lúc này request đó cũng vẫn đang xác nhận count = 2 và rate limiter cho phép call api. Và kết quả là 2 thằng này đều update count bằng 3. Mặc dù chính xác count phải bằng 4.</p>\n<p>Để giải quyết được vấn đề này thì chúng ta có thể dùng <a href=\"https://redis.io/topics/distlock\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Redis lock</a> để lock lại  count trước khi update (tức là phải update xong mới cho select).</p>\n<p>Tuy nhiên điều này có thể sẽ làm cho logic của chúng ta bị chậm khi nhiều request được gửi đồng thời <strong>từ 1 người dùng</strong>. Bởi vì khi select sẽ lock lại count của người dùng đó lại. Sau khi update count xong mới giải phóng lock để cho request tiếp theo dùng. </p>\n<p>Chú ý là cái việc lock này chỉ lock lại record của người dùng đó thôi nhé. Còn không lock lại record của người dùng khác. Hay nói cách khác chỉ lock row chứ không lock cả table.</p>\n<p><strong>Cần bao nhiêu memory để lưu trữ tất cả dữ liệu của người dùng?</strong></p>\n<p>Vì hash table của chúng ta sẽ lưu (user<em>id, count, start</em>time) nên chúng ta sẽ cần:</p>\n<ul>\n<li>8 bytes cho user_id</li>\n<li>2 bytes cho count (vậy giá trị max của count sẽ là 2^16 = 65,536)</li>\n<li>4 bytes cho start_time (lưu dạng epoch time)</li>\n</ul>\n<p>Khi đó sẽ dùng tổng cộng <strong>8 + 2 + 4 = 14 bytes</strong> để lưu dữ liệu người dùng.</p>\n<p>Giả sử như chúng ta cần 20 bytes cho overhead của hash table. Khi đó với 1 triệu người dùng sẽ cần:</p>\n<p><strong>(14 + 20 ) bytes * 1 triệu = 32.42 MB</strong></p>\n<p>Giả sử chúng ta cần 4 bytes để khoá mỗi record của người dùng để giải quyết vấn đề bên trên thì tổng cộng chúng ta sẽ cần:</p>\n<p><strong>(14 + 20 + 4) bytes * 1 triệu = 36 MB</strong></p>\n<p>Với rate limiting là 3 request/min thì hoàn toàn có thể đặt redis trên 1 con server. Tuy nhiên nếu chúng ta tăng rate limiting thành 10 request/s thì khi đó redis sẽ phải chịu khoảng 10 triệu request/s. Khi đó 1 con redis sẽ không thể chịu được nhiệt.</p>\n<p>Để giải quyết bài toán này thì chúng ta sẽ dùng nhiều con redis đặt phân tán. Khi update count vào trong redis thì rate limiter sẽ cần phải update trong tất cả những con Redis đó thì mới được.</p>\n<h3 id=\"2-thuật-toán-sliding-window\"><a href=\"#2-thu%E1%BA%ADt-to%C3%A1n-sliding-window\" aria-label=\"2 thuật toán sliding window permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Thuật toán Sliding Window</h3>\n<p>Để làm được thuật toán này thì chúng ta cần lưu thời gian gửi mỗi request lại, thay vì chỉ lưu giá trị gửi cuối cùng. Và sử dụng <a href=\"https://redislabs.com/ebook/part-2-core-concepts/chapter-3-commands-in-redis/3-5-sorted-sets/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Redis Sorted Set</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;code&gt;user_id: {count, Sorted Set &lt;start_time&gt;}\n\nVí dụ:\n12: {1560580210, 1560580212, 1560580213}\n5: {1560520442}&lt;/code&gt;</code></pre></div>\n<p>Giả sử như rate limiter cho phép gửi <strong>3 request/min</strong>. Khi đó flow sẽ như sau:</p>\n<ol>\n<li>Xoá tất cả các start<em>time trong Sorted Set mà có giá trị current</em>time - 1 min &#x3C; 0</li>\n<li>Tính tổng số lượng phần tử trong Sorted Set. Nếu tổng này > 3 thì sẽ block request đó lại. </li>\n<li>Insert start_time đó vào trong Sorted Set và cho phép request gửi đến API Server.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bc63938564c138d5dae91716e877a7c5/5df5c/sliding-window-example.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125.34482758620689%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAHuKYnO2mRm0VQy6BQP/8QAGRABAQEAAwAAAAAAAAAAAAAAAQAQAhEx/9oACAEBAAEFAp5MLixncM+Rf//EABgRAAIDAAAAAAAAAAAAAAAAAAACARAR/9oACAEDAQE/AVpIMP/EABgRAAIDAAAAAAAAAAAAAAAAAAACARAR/9oACAECAQE/AWp5NP/EABwQAAICAgMAAAAAAAAAAAAAAAACAzEy0QEQgf/aAAgBAQAGPwIzQyU2XGWnhsuMtDnv/8QAIBAAAgIBAwUAAAAAAAAAAAAAAAEhMREQQXFRYaGxwf/aAAgBAQABPyGsuu7oykDSt4Ou0cCRE8WB04+B0KL0njaVP//aAAwDAQACAAMAAAAQKNyB/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EAJIbaEnb//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxBIwuWCQ8v/xAAgEAABAwQCAwAAAAAAAAAAAAABACFxETFRYUGxEKHx/9oACAEBAAE/EAwAJgHCQLK+8Sjglxf6VgdC49iVKeNSq587g3aKlEgxfsTrF8alArqZ49r3ni/K/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/bc63938564c138d5dae91716e877a7c5/01472/sliding-window-example.webp 240w,\n/static/bc63938564c138d5dae91716e877a7c5/222bd/sliding-window-example.webp 480w,\n/static/bc63938564c138d5dae91716e877a7c5/620b9/sliding-window-example.webp 960w,\n/static/bc63938564c138d5dae91716e877a7c5/e72b4/sliding-window-example.webp 1160w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/bc63938564c138d5dae91716e877a7c5/3bc27/sliding-window-example.jpg 240w,\n/static/bc63938564c138d5dae91716e877a7c5/98431/sliding-window-example.jpg 480w,\n/static/bc63938564c138d5dae91716e877a7c5/b3ee8/sliding-window-example.jpg 960w,\n/static/bc63938564c138d5dae91716e877a7c5/5df5c/sliding-window-example.jpg 1160w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/bc63938564c138d5dae91716e877a7c5/b3ee8/sliding-window-example.jpg\"\n          alt=\"sliding window example\"\n          title=\"sliding window example\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p><strong>Với thuật toán này thì cần bao nhiêu memory để lưu dữ liệu?</strong></p>\n<p>Cấu trúc dữ liệu của chúng ta sẽ như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;code&gt;user_id: {start_time_1, start_time_2 ...., start_time_n}&lt;/code&gt;</code></pre></div>\n<p>Chúng ta sẽ cần 8 bytes để lưu user_id, 4 bytes để lưu epoch time.</p>\n<p>Giả sử như overhead của Sorted Set là 20 bytes, overhead của hash table là 20 bytes. Rate Limiting là 500 request/hour. Khi đó chúng ta sẽ cần:</p>\n<p><strong>8 + (4 + 20 bytes Sorted Set overhead) * 500 + 20 bytes hash table overhead = 12KB</strong></p>\n<p>Nếu chúng ta có 1 triệu user thì khi đóng tổng dung lượng bộ nhớ cần sẽ là:</p>\n<p><strong>12 KB * 1 triệu = 12GB</strong></p>\n<p>So sánh với thuật toán Fixed Window thì thuật toán Sliding Window dùng khá nhiều memory để lưu trữ. </p>\n<h2 id=\"kết-luận\"><a href=\"#k%E1%BA%BFt-lu%E1%BA%ADn\" aria-label=\"kết luận permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kết luận</h2>\n<p>Các bạn thấy việc thiết kế Rate Limiting cho API thế nào? Cũng không quá khó phải không nào.</p>\n<p>Hi vọng qua bài này sẽ giúp các bạn biết cách thiết kế Rate Limiting, giúp cho API của mình trở nên chuyên nghiệp hơn.</p>\n<p>==============</p>\n<p>Để nhận thông báo khi có bài viết mới nhất thì các bạn có thể like fanpage của mình ở bên dưới nhé:</p>\n<p>→→→ <a href=\"https://www.facebook.com/669339543503374\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nghệ thuật Coding Fanpage Facebook</a></p>\n<p>Chúc các bạn 1 tuần thật vui vẻ.</p>\n<p>Tài liệu tham khảo:<br>\n<a href=\"https://en.wikipedia.org/wiki/Rate_limiting\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://en.wikipedia.org/wiki/Rate_limiting</a><br>\n<a href=\"https://apisyouwonthate.com/blog/what-is-api-rate-limiting-all-about\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://apisyouwonthate.com/blog/what-is-api-rate-limiting-all-about</a><br>\n<a href=\"https://konghq.com/blog/how-to-design-a-scalable-rate-limiting-algorithm/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://konghq.com/blog/how-to-design-a-scalable-rate-limiting-algorithm/</a><br>\n<a href=\"https://www.keycdn.com/support/rate-limiting\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.keycdn.com/support/rate-limiting</a><br>\n<a href=\"https://engineering.classdojo.com/blog/2015/02/06/rolling-rate-limiter/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://engineering.classdojo.com/blog/2015/02/06/rolling-rate-limiter/</a></p>","fields":{"slug":"2019/06/15/thiet-ke-api-rate-limiting/","tagSlugs":["/tag/api/","/tag/api-rate-limiter/","/tag/api-rate-limiting/","/tag/rate-limiter/","/tag/rate-limiting/"]},"frontmatter":{"date":"2019-06-15T12:49:24.000Z","description":null,"tags":["api","api rate limiter","api rate limiting","rate limiter","rate limiting"],"title":"Thiết kế API Rate Limiting","socialImage":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"2019/06/15/thiet-ke-api-rate-limiting/"}}}