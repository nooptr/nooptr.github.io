{"componentChunkName":"component---src-templates-post-template-js","path":"/2020-05-10-cau-lenh-linux-hay-dung-trong-phan-tich-log","result":{"data":{"markdownRemark":{"id":"8b24cf64-1d2d-599b-99ce-41124ebd5e9e","html":"<p>Hôm nay mình chia sẻ cho mọi người 1 số câu lệnh linux mình hay dùng trong phân tích log trên server.</p>\n<h1 id=\"1-các-usecase-hay-dùng\"><a href=\"#1-c%C3%A1c-usecase-hay-d%C3%B9ng\" aria-label=\"1 các usecase hay dùng permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Các usecase hay dùng</h1>\n<ul>\n<li>Muốn điều tra nguyên nhân khi số lượng access đến server tăng dột biến</li>\n<li>Đã phát hiện trên server có lỗ hổng và muốn điều tra xem đã có ai xâm nhập vào hay chưa</li>\n</ul>\n<h1 id=\"2-các-câu-lệnh-linux-hay-dùng\"><a href=\"#2-c%C3%A1c-c%C3%A2u-l%E1%BB%87nh-linux-hay-d%C3%B9ng\" aria-label=\"2 các câu lệnh linux hay dùng permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Các câu lệnh linux hay dùng</h1>\n<table>\n<thead>\n<tr>\n<th>Command line</th>\n<th>Giải thích</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>grep</td>\n<td>Tìm các dòng chứa chuỗi được chỉ định</td>\n</tr>\n<tr>\n<td>awk</td>\n<td>Phân tách cột và tìm kiếm hàng có điều kiện</td>\n</tr>\n<tr>\n<td>sort</td>\n<td>Sắp xếp dòng</td>\n</tr>\n<tr>\n<td>uniq</td>\n<td>Loại bỏ các hàng trùng lặp và đếm</td>\n</tr>\n<tr>\n<td>wc</td>\n<td>Đếm số ký tự, số dòng</td>\n</tr>\n<tr>\n<td>sed</td>\n<td>Thay thế điều kiện quy định</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"3-đối-tượng-phân-tích\"><a href=\"#3-%C4%91%E1%BB%91i-t%C6%B0%E1%BB%A3ng-ph%C3%A2n-t%C3%ADch\" aria-label=\"3 đối tượng phân tích permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Đối tượng phân tích</h1>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># access_log\n\n203.0.113.1 - - [03/May/2020:12:00:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64)&quot;\n203.0.113.1 - - [03/May/2020:12:10:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64)&quot;\n203.0.113.2 - - [03/May/2020:12:20:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.3; Win64; x64)&quot;\n203.0.113.2 - - [03/May/2020:12:30:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.3; Win64; x64)&quot;\n203.0.113.2 - - [03/May/2020:12:40:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.3; Win64; x64)&quot;\n198.51.100.3 - - [03/May/2020:12:50:00 +0900] &quot;GET /index.cgi?page=&lt;Script&gt;alert(&#39;Evil&#39;)&lt;/Script&gt; HTTP/1.1&quot; 200 3000 &quot;-&quot; &quot;Evil User Agent&quot;\n198.51.100.3 - - [03/May/2020:13:00:00 +0900] &quot;GET /../../../../../etc/shadow HTTP/1.1&quot; 200 3000 &quot;-&quot; &quot;Evil User Agent&quot;</code></pre></div>\n<p>Trong đó:  </p>\n<ul>\n<li>203.0.113.0/24 là địa chỉ ip đúng từ người dùng</li>\n<li>198.51.100.0/24 là địa chỉ ip từ nguồn đáng ngờ</li>\n</ul>\n<h1 id=\"4-áp-dụng\"><a href=\"#4-%C3%A1p-d%E1%BB%A5ng\" aria-label=\"4 áp dụng permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Áp dụng</h1>\n<h2 id=\"41-tìm-kiếm-đặc-biệt-grep\"><a href=\"#41-t%C3%ACm-ki%E1%BA%BFm-%C4%91%E1%BA%B7c-bi%E1%BB%87t-grep\" aria-label=\"41 tìm kiếm đặc biệt grep permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.1. Tìm kiếm đặc biệt (grep)</h2>\n<h3 id=\"・điều-tra-cuộc-tấn-công-vào-thư-mục\"><a href=\"#%E3%83%BB%C4%91i%E1%BB%81u-tra-cu%E1%BB%99c-t%E1%BA%A5n-c%C3%B4ng-v%C3%A0o-th%C6%B0-m%E1%BB%A5c\" aria-label=\"・điều tra cuộc tấn công vào thư mục permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Điều tra cuộc tấn công vào thư mục</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ grep -n &quot;\\.\\.&quot; access_log\n7:198.51.100.3 - - [03/May/2020:13:00:00 +0900] &quot;GET /../../../../../etc/shadow HTTP/1.1&quot; 200 3000 &quot;-&quot; &quot;Evil User Agent&quot;</code></pre></div>\n<h3 id=\"・điều-tra-chèn-script-đáng-ngờ\"><a href=\"#%E3%83%BB%C4%91i%E1%BB%81u-tra-ch%C3%A8n-script-%C4%91%C3%A1ng-ng%E1%BB%9D\" aria-label=\"・điều tra chèn script đáng ngờ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Điều tra chèn script đáng ngờ</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ grep -i &quot;&lt;script&gt;&quot; --color access_log\n198.51.100.3 - - [03/May/2020:12:50:00 +0900] &quot;GET /index.cgi?page=&lt;Script&gt;alert(&#39;Evil&#39;)&lt;/Script&gt; HTTP/1.1&quot; 200 3000 &quot;-&quot; &quot;Evil User Agent&quot;</code></pre></div>\n<h3 id=\"・điều-tra-chèn-thẻ-tag-html-đáng-ngờ\"><a href=\"#%E3%83%BB%C4%91i%E1%BB%81u-tra-ch%C3%A8n-th%E1%BA%BB-tag-html-%C4%91%C3%A1ng-ng%E1%BB%9D\" aria-label=\"・điều tra chèn thẻ tag html đáng ngờ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Điều tra chèn thẻ tag html đáng ngờ</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ grep -E &quot;&lt;[^&gt;]+&gt;[^&lt;]+&lt;[^&gt;]+&gt;&quot; -o access_log\n&lt;Script&gt;alert(&#39;Evil&#39;)&lt;/Script&gt;</code></pre></div>\n<p>Giải thích về option trong grep:</p>\n<table>\n<thead>\n<tr>\n<th>option</th>\n<th>Giải thích</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-n</td>\n<td>Hiển thị số dòng của dòng match</td>\n</tr>\n<tr>\n<td>-i</td>\n<td>Không phân biệt chữ hoa và chữ thường</td>\n</tr>\n<tr>\n<td>—color</td>\n<td>Hiển thị màu đối với từ đã match</td>\n</tr>\n<tr>\n<td>-o</td>\n<td>Hiển thị phần đã match</td>\n</tr>\n<tr>\n<td>-E</td>\n<td>Sử dụng biểu thức regex</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"42-loại-bỏ-log-không-cần-thiết\"><a href=\"#42-lo%E1%BA%A1i-b%E1%BB%8F-log-kh%C3%B4ng-c%E1%BA%A7n-thi%E1%BA%BFt\" aria-label=\"42 loại bỏ log không cần thiết permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.2. Loại bỏ log không cần thiết</h2>\n<h3 id=\"・loại-bỏ-log-từ-nguồn-chuẩn\"><a href=\"#%E3%83%BBlo%E1%BA%A1i-b%E1%BB%8F-log-t%E1%BB%AB-ngu%E1%BB%93n-chu%E1%BA%A9n\" aria-label=\"・loại bỏ log từ nguồn chuẩn permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Loại bỏ log từ nguồn chuẩn</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ grep -v &quot;203.0.113.&quot; access_log\n198.51.100.3 - - [03/May/2020:12:50:00 +0900] &quot;GET /index.cgi?page=&lt;Script&gt;alert(&#39;Evil&#39;)&lt;/Script&gt; HTTP/1.1&quot; 200 3000 &quot;-&quot; &quot;Evil User Agent&quot;\n198.51.100.3 - - [03/May/2020:13:00:00 +0900] &quot;GET /../../../../../etc/shadow HTTP/1.1&quot; 200 3000 &quot;-&quot; &quot;Evil User Agent&quot;</code></pre></div>\n<p>Giải thích về option trong grep:</p>\n<table>\n<thead>\n<tr>\n<th>option</th>\n<th>Giải thích</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-v</td>\n<td>Không hiển thị dòng match</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"43-trích-xuất-phần-tửawk\"><a href=\"#43-tr%C3%ADch-xu%E1%BA%A5t-ph%E1%BA%A7n-t%E1%BB%ADawk\" aria-label=\"43 trích xuất phần tửawk permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.3. Trích xuất phần tử(awk)</h2>\n<h3 id=\"・trích-xuất-ra-địa-chỉ-ip-client\"><a href=\"#%E3%83%BBtr%C3%ADch-xu%E1%BA%A5t-ra-%C4%91%E1%BB%8Ba-ch%E1%BB%89-ip-client\" aria-label=\"・trích xuất ra địa chỉ ip client permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Trích xuất ra địa chỉ ip client</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ awk &#39;{print $1}&#39; access_log \n203.0.113.1\n203.0.113.1\n203.0.113.2\n203.0.113.2\n203.0.113.2\n198.51.100.3\n198.51.100.3</code></pre></div>\n<h3 id=\"・trích-xuất-ra-user-agent-của-client\"><a href=\"#%E3%83%BBtr%C3%ADch-xu%E1%BA%A5t-ra-user-agent-c%E1%BB%A7a-client\" aria-label=\"・trích xuất ra user agent của client permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Trích xuất ra User Agent của client</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ awk -F[\\&quot;] &#39;{print $6}&#39; access_log \nMozilla/5.0 (Windows NT 10.0; Win64; x64)\nMozilla/5.0 (Windows NT 10.0; Win64; x64)\nMozilla/5.0 (Windows NT 6.3; Win64; x64)\nMozilla/5.0 (Windows NT 6.3; Win64; x64)\nMozilla/5.0 (Windows NT 6.3; Win64; x64)\nEvil User Agent\nEvil User Agent</code></pre></div>\n<p>Giải thích về option trong awk:</p>\n<table>\n<thead>\n<tr>\n<th>option</th>\n<th>Giải thích</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>{print $1}</td>\n<td>Hiển thị ra cột đầu tiên được phân tách bằng dấu phân cách</td>\n</tr>\n<tr>\n<td>-F</td>\n<td>Chỉ định dấu phân cách (mặc định là khoảng trắng)</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"44-thống-kê-và-sắp-xếp-sortuniqwc\"><a href=\"#44-th%E1%BB%91ng-k%C3%AA-v%C3%A0-s%E1%BA%AFp-x%E1%BA%BFp-sortuniqwc\" aria-label=\"44 thống kê và sắp xếp sortuniqwc permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.4. Thống kê và sắp xếp (sort/uniq/wc)</h2>\n<h3 id=\"・hiển-thị-ra-số-lượng-của-mỗi-địa-chỉ-ip-client\"><a href=\"#%E3%83%BBhi%E1%BB%83n-th%E1%BB%8B-ra-s%E1%BB%91-l%C6%B0%E1%BB%A3ng-c%E1%BB%A7a-m%E1%BB%97i-%C4%91%E1%BB%8Ba-ch%E1%BB%89-ip-client\" aria-label=\"・hiển thị ra số lượng của mỗi địa chỉ ip client permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Hiển thị ra số lượng của mỗi địa chỉ ip client</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ awk &#39;{print $1}&#39; access_log | sort | uniq -c | sort -rn\n      3 203.0.113.2\n      2 203.0.113.1\n      2 198.51.100.3</code></pre></div>\n<h3 id=\"・tổng-số-lượng-của-địa-chỉ-duy-nhất-ip-client\"><a href=\"#%E3%83%BBt%E1%BB%95ng-s%E1%BB%91-l%C6%B0%E1%BB%A3ng-c%E1%BB%A7a-%C4%91%E1%BB%8Ba-ch%E1%BB%89-duy-nh%E1%BA%A5t-ip-client\" aria-label=\"・tổng số lượng của địa chỉ duy nhất ip client permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Tổng số lượng của địa chỉ duy nhất ip client</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ awk &#39;{print $1}&#39; access_log | sort | uniq | wc -l\n3</code></pre></div>\n<p>Giải thích:</p>\n<table>\n<thead>\n<tr>\n<th>command line, option</th>\n<th>Giải thích</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>uniq -c</td>\n<td>Hiển thị số trùng lặp (yêu cầu sắp xếp để so sánh trước và sau)</td>\n</tr>\n<tr>\n<td>sort -n</td>\n<td>Sắp xếp các trường số theo giá trị số học</td>\n</tr>\n<tr>\n<td>sort -r</td>\n<td>Sắp xếp theo thứ tự giảm dần (mặc định là thứ tự tăng dần)</td>\n</tr>\n<tr>\n<td>wc -l</td>\n<td>Hiển thị ra số dòng</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"45-thay-thế-sed\"><a href=\"#45-thay-th%E1%BA%BF-sed\" aria-label=\"45 thay thế sed permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5. Thay thế (sed)</h2>\n<h3 id=\"・ẩn-danh-địa-chỉ-ip-nguồn-để-truy-cập-bình-thường\"><a href=\"#%E3%83%BB%E1%BA%A9n-danh-%C4%91%E1%BB%8Ba-ch%E1%BB%89-ip-ngu%E1%BB%93n-%C4%91%E1%BB%83-truy-c%E1%BA%ADp-b%C3%ACnh-th%C6%B0%E1%BB%9Dng\" aria-label=\"・ẩn danh địa chỉ ip nguồn để truy cập bình thường permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>・Ẩn danh địa chỉ IP nguồn để truy cập bình thường</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ sed &quot;s/203\\.0\\.113\\.[0-9]\\{1\\,3\\}/xxx.xxx.xxx.xxx/g&quot; access_log\nxxx.xxx.xxx.xxx - - [03/May/2020:12:00:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64)&quot;\nxxx.xxx.xxx.xxx - - [03/May/2020:12:10:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64)&quot;\nxxx.xxx.xxx.xxx - - [03/May/2020:12:20:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.3; Win64; x64)&quot;\nxxx.xxx.xxx.xxx - - [03/May/2020:12:30:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.3; Win64; x64)&quot;\nxxx.xxx.xxx.xxx - - [03/May/2020:12:40:00 +0900] &quot;GET /index.html HTTP/1.1&quot; 200 1000 &quot;http://example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.3; Win64; x64)&quot;\n198.51.100.3 - - [03/May/2020:12:50:00 +0900] &quot;GET /index.cgi?page=&lt;Script&gt;alert(&#39;Evil&#39;)&lt;/Script&gt; HTTP/1.1&quot; 200 3000 &quot;-&quot; &quot;Evil User Agent&quot;\n198.51.100.3 - - [03/May/2020:13:00:00 +0900] &quot;GET /../../../../../etc/shadow HTTP/1.1&quot; 200 3000 &quot;-&quot; &quot;Evil User Agent&quot;</code></pre></div>\n<p>Giải thích:</p>\n<table>\n<thead>\n<tr>\n<th>option</th>\n<th>Giải thích</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>s/string A/string B/g</td>\n<td>Thay chuỗi A bằng chuỗi B. Thay thế tất cả bằng cách thêm g.</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"kết-luận\"><a href=\"#k%E1%BA%BFt-lu%E1%BA%ADn\" aria-label=\"kết luận permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kết luận</h1>\n<p>Nếu sử dụng 6 câu lệnh mình bảo bên trên thì chúng ta có thể phân tích log 1 cách dễ dàng.</p>\n<p>Hơn nữa, thông thường hay sử dụng kí tự pipe line | để phân tích log 1 cách hiệu quả hơn.</p>\n<p>Ví dụ:  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ grep -v &quot;203.0.113.&quot; access_log | awk &#39;{print $1}&#39; | sort | uniq -c | sort -rn\n      2 198.51.100.3</code></pre></div>\n<p>==============</p>\n<p>Để nhận thông báo khi có bài viết mới nhất thì các bạn có thể like fanpage của mình ở bên dưới nhé:</p>\n<p>→→→ <a href=\"https://www.facebook.com/669339543503374\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nghệ thuật Coding Fanpage Facebook</a></p>","fields":{"slug":"2020-05-10-cau-lenh-linux-hay-dung-trong-phan-tich-log","tagSlugs":["/tag/linux/","/tag/access-log/"]},"frontmatter":{"date":"2020-05-10T22:10:30.000Z","description":"Hôm nay mình chia sẻ cho mọi người 1 số câu lệnh linux mình hay dùng trong phân tích log trên server.","tags":["linux","access log"],"title":"6 câu lệnh linux hay dùng trong phân tích log","socialImage":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"2020-05-10-cau-lenh-linux-hay-dung-trong-phan-tich-log"}}}