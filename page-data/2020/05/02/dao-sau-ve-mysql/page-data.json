{"componentChunkName":"component---src-templates-post-template-js","path":"/2020/05/02/dao-sau-ve-mysql","result":{"data":{"markdownRemark":{"id":"ccf9d866-c2ce-592e-ad05-8ce3f568d80a","html":"<p>Hôm nay tình cờ đọc được 1 quyển sách về MySQL thấy khá hay nên muốn chia sẻ lại với mọi người những cái mình đã học được.</p>\n<p>Về MySQL thì chắc ai cũng đã từng dùng hay đang dùng nó cho một số dự án từ vài người dùng đến hàng triệu người dùng. Từ các website về blog cho đến các trang thương mại điện tử, các server dành cho game…</p>\n<p>Với hệ thống nhỏ nhỏ thì chắc chẳng cần quan tâm gì nhiều đến cách hoạt động của nó làm gì cho mệt. Nhưng mà khi hệ thống dã lớn lên, phải xử lí hàng nghìn, hàng triệu queries/s thì việc hiểu rõ được cơ chế hoạt động cũng nó là điều vô cùng quan trọng.</p>\n<p>Việc master được tất tần tật về MySQL thì vô cùng khó, nhưng mà hiểu được cái gì đó sâu sâu 1 chút thì cũng giúp chúng ta hơn hẳn được nhiều người rồi.</p>\n<p>Nên hôm nay mình sẽ giới thiệu đến mọi người 1 số vấn đề mà mọi người đang chưa hiểu hoặc hiểu nhầm về MySQL nhé.</p>\n<p><strong>Mục tiêu bài viết:</strong><br>\n・Hiểu được chức năng bên trong MySQL<br>\n・Biết cách thiết kế dữ liệu cho tối ưu nhất  </p>\n<p><strong>Đối tượng hướng đến:</strong><br>\n・Người đã từng làm việc với MySQL<br>\n・Người muốn tối ưu hiệu năng MySQL  </p>\n<h2 id=\"1-đơn-vị-io\"><a href=\"#1-%C4%91%C6%A1n-v%E1%BB%8B-io\" aria-label=\"1 đơn vị io permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Đơn vị I/O</h2>\n<p>Khi dùng MySQL thì đa số là thao tác trên các record(bản ghi) của MySQL. Nên đa số chúng ta đều nghĩ là dữ liệu được xử lí theo đơn vị record. Nhưng thực tế MySQL lại thao tác dữ liệu theo từng đơn vị page (trang) có kích thước được định nghĩa trước.</p>\n<p>Để dễ hiểu thì chúng ta cùng xem ảnh bên dưới:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5755d0f08e492040065f9f20dabfdf5a/2f950/20200502_mysql_page.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAB6UlEQVQoz22S22/SYBiH90d7qVnihYlXXpgZY1C2xTmJm0aHHHQHJ5siYxkI4QwRXSiHQQv0DO3j14bGRv2SJ83b3/c+fb+2a67r4i3XcXEWjs/SXvoENd4WQTgL516v7xCutaDQGzO0NyOspMwyPcVOKVgJGe1gROFJllIkhxYfYScVFiKzxT4zOfF7vN5gqLVgQm00QGtXUZoVqp8/0cqeMamXMH616Oe+MXl3in14ibR/TG37gJ+xD5gf8xjxr0LYXQmdP8LxrEdXLtCU8qQzrzjPvafdvaCtZWnOz2hJ4iGDU84Le8SPn3KS26XRO6FynaY/aa2OHBIqcwVJlhhOh/zod4lJR+zIR2zNE2waCV7aSfaXKaJSjI1alEh3h9dWkhfWW8pGzXc4YeHCNMG2vbsCh8qiw5XTpLhsU7SbbE3rPFA73OvkuHN1yO1KhvtKk3W5TmY+8B1L76M4K2FXNfgyNcmrNheCkgrlOVR0gQaP+wvujmC9PeXW9x4PG0NSisve2KU6s1YThoSXis6jgc7m2OTZjUnkxvDZuJZ9tscGz8c6u4pFdGJRnmnesbB1FVPXQr/NSmjoukDDFke3TENg+tSqVUrFop97tWkYPoaHqFVNQxfZP0Lv6oh39zfB+l8WEHb8BqON5hfQX4CfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/5755d0f08e492040065f9f20dabfdf5a/01472/20200502_mysql_page.webp 240w,\n/static/5755d0f08e492040065f9f20dabfdf5a/222bd/20200502_mysql_page.webp 480w,\n/static/5755d0f08e492040065f9f20dabfdf5a/620b9/20200502_mysql_page.webp 960w,\n/static/5755d0f08e492040065f9f20dabfdf5a/28063/20200502_mysql_page.webp 1440w,\n/static/5755d0f08e492040065f9f20dabfdf5a/ded3f/20200502_mysql_page.webp 1600w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/5755d0f08e492040065f9f20dabfdf5a/0783d/20200502_mysql_page.png 240w,\n/static/5755d0f08e492040065f9f20dabfdf5a/782f4/20200502_mysql_page.png 480w,\n/static/5755d0f08e492040065f9f20dabfdf5a/f570d/20200502_mysql_page.png 960w,\n/static/5755d0f08e492040065f9f20dabfdf5a/8d0ff/20200502_mysql_page.png 1440w,\n/static/5755d0f08e492040065f9f20dabfdf5a/2f950/20200502_mysql_page.png 1600w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/5755d0f08e492040065f9f20dabfdf5a/f570d/20200502_mysql_page.png\"\n          alt=\"20200502 mysql page\"\n          title=\"20200502 mysql page\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Nhìn vào ảnh bên trên thì mình nghĩ mọi người có thể hiểu được. Thì đơn vị I/0 nhỏ nhất trong MySQL không phải là record mà là page nhé.</p>\n<p>Với MySQL thì kích thước của page default là 16KB. (Ở đây mọi người nên chú ý 1 điểm là nếu muốn change size của page thì chúng ta phải xoá instance đi và tạo lại thì mới change được, còn chỉ start stop mysql thì không thể change được nhé)</p>\n<p>Chính vì lí do đó mà thằng RDS của AWS không có option change được size của page.</p>\n<p>Vậy đến đây đa số cũng biết được đơn vị cấu tạo nhỏ nhất của I/O trong MySQL là gì rồi đúng không ak? </p>\n<p>Vậy biết được cái này để làm gì? Thì đi đến phần tiếp theo nhá.</p>\n<h2 id=\"2-ảnh-hưởng-to-lớn-của-auto_increment\"><a href=\"#2-%E1%BA%A3nh-h%C6%B0%E1%BB%9Fng-to-l%E1%BB%9Bn-c%E1%BB%A7a-auto_increment\" aria-label=\"2 ảnh hưởng to lớn của auto_increment permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Ảnh hưởng to lớn của AUTO_INCREMENT</h2>\n<p>Việc setting primary key (khoá chính) với AUTO_INCREMENT thì chắc ai cũng biết rồi. Nhưng mà việc setting này có ảnh hưởng to lớn đến hiệu năng như thế nào thì chúng ta cùng đi xem 2 ví dụ dưới đây nhé.</p>\n<p>Để dễ hiểu, mình sẽ lấy 1 ví dụ trong game nhé. Đó là muốn tạo ra 1 bảng lưu giữ thông tin nhân vật(character) của người dùng.</p>\n<p>Ví dụ 1:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">CREATE TABLE user_characters <span class=\"token punctuation\">{</span>\n  user_id INT NOT NULL DEFAULT <span class=\"token number\">0</span>,\n  user_character_id INT NOT NULL DEFAULT <span class=\"token number\">0</span>,\n  character_id INT NOT NULL DEFAULT <span class=\"token number\">0</span>,\n  PRIMARY_KEY <span class=\"token punctuation\">(</span>user_id, user_character_id<span class=\"token punctuation\">)</span>,\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Ví dụ 2:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">CREATE TABLE user_characters <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">id</span> INT NOT NULL PRIMARY KEY AUTO_INCREMENT,\n  user_id INT NOT NULL DEFAULT <span class=\"token number\">0</span>,\n  user_character_id INT NOT NULL DEFAULT <span class=\"token number\">0</span>,\n  character_id INT NOT NULL DEFAULT <span class=\"token number\">0</span>,\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Khi chúng ta muốn lấy thông tin nhân vật mà người dùng có ID =4 1234 đang giữ thì sẽ thực hiện câu SQL như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SELECT * FROM user_characters WHERE user_id = 41234</code></pre></div>\n<p>Vậy hiệu năng khi thực hiện câu SQL này trên 2 ví dụ trên khác nhau thế nào?</p>\n<p>Cụ thể như ảnh bên dưới:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f0e614dffb5dacb4954a7493fb7c7665/2f950/20200502_01_mysql_page_primary_key.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACw0lEQVQ4y31TaVNaQRDkRydlGY9SEXjIJYKIPEAgIPFAuQRPjAJiQgA1XvmSRAIqICYV0SBXZ94K+MVkqrp6p3e337yaWVGr1YIQAjcaTYZ6vQFBvry8wv7+BySTn5BKpVGp3KPZbJ9rPp1tEnfuCyHqLCqVO8zO8HBapjGtVYLXaQhqWKd0cPBGmCe1TDNNqOE0G+G2mWmtQjIRZ/c7xl3Dh/s7BFzj8Ls0mOfFWLRIGS/b5AjN6SiXMCyYJUz3OpRwTw3gJLXzsuGfhwo2loxY90wh6FIh9G6cPqAk1mLLZ2bayqwGK24NAk4lO+dzyPHlaO8fhlRheF6H1Xk9lmak8Nrl8FglVMkYVhcMTFu2cQxLpAdcaizwwzjLRLuGgpeo1XauUoXRVReiYRc2vTwiPgurbDfkQGJjDu8DVmz7rYj4Saf9aNiJdfqjr+fpdlPaFeI/Ua1WUSgUCEXc3JRZXqvVCbU21/H4WGvnTxCViiWUCiUU6ZKA8s0toYzbchkX378hnUrR2HzE0eFhdzReCmGP/bJa2g8NNwiNbBBKSR+MWhl0CjFGel9DNtgHLSeBanQIZr0W+VweP7I5ZC+yKFwXGPK5S1Z5x1S0rR9GjOewZ5ETyxAzybA+KYae64dW0gvV0Cuohl9jQvoGBsUQlJSrR3pof4DlGnEPrnLZbmNEa2SyZVMhYlcRK7A5QyNhU2JtUU8dn0DIrabRUSM8p8WGx4DgrJLWwkgpGAdptH6Vr7uNEXnsHDx2GRZtNMgWGmSnAsG3CuxMjiJqkGKfVxDGEDNypEmRMMmZJnB8mkPcKMNd8erZMBMPI7P3hHRsBcfJCFK7foTsYwhaZfDRq/Dzo/CbRxGiV+M1jSBAL8ZHzPaJfxbzz4YvdazRaOD8cwKnBzGcZHYZTg+iOKdXcZzeYesT4rPDGMsf7n93m/IXXdakXFHdu/AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/f0e614dffb5dacb4954a7493fb7c7665/01472/20200502_01_mysql_page_primary_key.webp 240w,\n/static/f0e614dffb5dacb4954a7493fb7c7665/222bd/20200502_01_mysql_page_primary_key.webp 480w,\n/static/f0e614dffb5dacb4954a7493fb7c7665/620b9/20200502_01_mysql_page_primary_key.webp 960w,\n/static/f0e614dffb5dacb4954a7493fb7c7665/28063/20200502_01_mysql_page_primary_key.webp 1440w,\n/static/f0e614dffb5dacb4954a7493fb7c7665/ded3f/20200502_01_mysql_page_primary_key.webp 1600w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/f0e614dffb5dacb4954a7493fb7c7665/0783d/20200502_01_mysql_page_primary_key.png 240w,\n/static/f0e614dffb5dacb4954a7493fb7c7665/782f4/20200502_01_mysql_page_primary_key.png 480w,\n/static/f0e614dffb5dacb4954a7493fb7c7665/f570d/20200502_01_mysql_page_primary_key.png 960w,\n/static/f0e614dffb5dacb4954a7493fb7c7665/8d0ff/20200502_01_mysql_page_primary_key.png 1440w,\n/static/f0e614dffb5dacb4954a7493fb7c7665/2f950/20200502_01_mysql_page_primary_key.png 1600w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/f0e614dffb5dacb4954a7493fb7c7665/f570d/20200502_01_mysql_page_primary_key.png\"\n          alt=\"20200502 01 mysql page primary key\"\n          title=\"20200502 01 mysql page primary key\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Với ví dụ 1, thì user<em>id được gắn là khoá chính. Nên dữ liệu sẽ được sắp xếp theo thứ tự của user</em>id. Do đó mà thông tin lấy được từ user_characters khả năng cao sẽ được nằm trong 1 page. Mà nếu dữ liệu được nằm trong 1 page thì chắc chắn I/O sẽ được giảm mạnh, và hiệu suất query sẽ tốt hơn.</p>\n<p>Nhưng với ví dụ 2 thì hoàn toàn khác. Lúc này khoá chính của chúng ta là id. Nên việc dữ liệu tất cả nhân vật mà user_id = 41234 đang nắm giữ khả năng cao sẽ nằm rải rác trên nhiều page khác nhau. Kết quả là I/O sẽ tăng và hiệu năng query sẽ giảm đi rất là nhiều.</p>\n<p>Chính vì vậy, với nhiều dữ liệu sử dụng đồng thời như ví dụ trên thì chúng ta cố gắng sắp xếp nó cùng vào 1 page nhé.</p>\n<h2 id=\"kết-luận\"><a href=\"#k%E1%BA%BFt-lu%E1%BA%ADn\" aria-label=\"kết luận permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kết luận</h2>\n<p>Hôm nay thế thôi nhỉ. Để hôm khác mình sẽ bổ sung thêm(Tại ngại vẽ hình). Hi vọng qua bài này sẽ giúp ích mọi người trong quá trình thiết kế cơ sở dữ liệu sao cho hiệu năng tốt nhất.</p>\n<p>Chúc mọi người cuối tuần vui vẻ.</p>\n<p>==============</p>\n<p>Để nhận thông báo khi có bài viết mới nhất thì các bạn có thể like fanpage của mình ở bên dưới nhé:</p>\n<p>→→→ <a href=\"https://www.facebook.com/669339543503374\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nghệ thuật Coding Fanpage Facebook</a></p>","fields":{"slug":"2020/05/02/dao-sau-ve-mysql","tagSlugs":["/tag/mysql/"]},"frontmatter":{"date":"2020-05-02T23:55:30.000Z","description":"Hầu như ai cũng đã từng và đang dùng MySQL nhưng mà cũng có nhiều thứ mà ít ai biết về MySQL. Nên hôm nay mình sẽ đào sâu về nó để chỉ cho mọi người biết nhé ...","tags":["mysql"],"title":"Đào sâu về MySQL","socialImage":"/media/20200502_mysql_page.png"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"2020/05/02/dao-sau-ve-mysql"}}}